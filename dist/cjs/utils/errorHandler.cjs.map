{"version":3,"file":"errorHandler.cjs","sources":["../../../../src/utils/errorHandler.ts"],"sourcesContent":["import { IncomingMessage, ServerResponse } from 'http';\r\n\r\nexport interface CustomError extends Error {\r\n  statusCode?: number;\r\n  code?: string;\r\n  details?: unknown;\r\n}\r\n\r\nexport interface ErrorPageOptions {\r\n  styles?: string;\r\n  showStack?: boolean;\r\n  showDetails?: boolean;\r\n}\r\n\r\nexport function generateErrorPage(\r\n  statusCode: number,\r\n  message: string,\r\n  error?: CustomError,\r\n  options: ErrorPageOptions = {}\r\n): string {\r\n  const {\r\n    styles = `\r\n      body { font-family: system-ui; padding: 2rem; max-width: 600px; margin: 0 auto; }\r\n      .error { background: #f8d7da; border: 1px solid #f5c6cb; padding: 1rem; border-radius: 4px; }\r\n      .details { margin-top: 1rem; font-family: monospace; white-space: pre-wrap; }\r\n    `,\r\n    showStack = process.env.NODE_ENV !== 'production',\r\n    showDetails = process.env.NODE_ENV !== 'production'\r\n  } = options;\r\n\r\n  const details = error && showDetails ? `\r\n    <div class=\"details\">\r\n      <strong>Error Code:</strong> ${error.code || 'UNKNOWN'}<br>\r\n      ${error.details ? `<strong>Details:</strong> ${JSON.stringify(error.details, null, 2)}` : ''}\r\n      ${error.stack && showStack ? `<strong>Stack:</strong>\\n${error.stack}` : ''}\r\n    </div>\r\n  ` : '';\r\n\r\n  return `\r\n    <!DOCTYPE html>\r\n    <html>\r\n    <head>\r\n        <title>Error ${statusCode}</title>\r\n        <style>${styles}</style>\r\n    </head>\r\n    <body>\r\n        <h1>Error ${statusCode}</h1>\r\n        <div class=\"error\">\r\n            <p>${message}</p>\r\n            ${details}\r\n        </div>\r\n    </body>\r\n    </html>\r\n  `;\r\n}\r\n\r\nexport async function handleError(\r\n  error: CustomError,\r\n  req: IncomingMessage,\r\n  res: ServerResponse\r\n): Promise<void> {\r\n  const statusCode = error.statusCode || 500;\r\n  const message = error.message || 'Internal Server Error';\r\n\r\n  console.error('Server error:', {\r\n    statusCode,\r\n    message,\r\n    path: req.url,\r\n    method: req.method,\r\n    error: {\r\n      name: error.name,\r\n      code: error.code,\r\n      stack: error.stack,\r\n      details: error.details\r\n    }\r\n  });\r\n\r\n  const errorPage = generateErrorPage(statusCode, message, error);\r\n\r\n  res.writeHead(statusCode, {\r\n    'Content-Type': 'text/html',\r\n    'Cache-Control': 'no-store',\r\n    'X-Content-Type-Options': 'nosniff'\r\n  });\r\n  res.end(errorPage);\r\n}"],"names":["process"],"mappings":";;;;AAcM,SAAU,iBAAiB,CAC/B,UAAkB,EAClB,OAAe,EACf,KAAmB,EACnB,OAAA,GAA4B,EAAE,EAAA;IAE9B,MAAM,EACJ,MAAM,GAAG,CAAA;;;;KAIR,EACD,SAAS,GAAGA,6BAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,YAAY,EACjD,WAAW,GAAGA,6BAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,YAAY,EACpD,GAAG,OAAO,CAAC;AAEZ,IAAA,MAAM,OAAO,GAAG,KAAK,IAAI,WAAW,GAAG,CAAA;;qCAEJ,KAAK,CAAC,IAAI,IAAI,SAAS,CAAA;QACpD,KAAK,CAAC,OAAO,GAAG,CAA6B,0BAAA,EAAA,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC,CAAE,CAAA,GAAG,EAAE,CAAA;AAC1F,MAAA,EAAA,KAAK,CAAC,KAAK,IAAI,SAAS,GAAG,CAA4B,yBAAA,EAAA,KAAK,CAAC,KAAK,CAAA,CAAE,GAAG,EAAE,CAAA;;GAE9E,GAAG,EAAE,CAAC;IAEP,OAAO,CAAA;;;;uBAIc,UAAU,CAAA;iBAChB,MAAM,CAAA;;;oBAGH,UAAU,CAAA;;iBAEb,OAAO,CAAA;cACV,OAAO,CAAA;;;;GAIlB,CAAC;AACJ,CAAC;AAEM,eAAe,WAAW,CAC/B,KAAkB,EAClB,GAAoB,EACpB,GAAmB,EAAA;AAEnB,IAAA,MAAM,UAAU,GAAG,KAAK,CAAC,UAAU,IAAI,GAAG,CAAC;AAC3C,IAAA,MAAM,OAAO,GAAG,KAAK,CAAC,OAAO,IAAI,uBAAuB,CAAC;AAEzD,IAAA,OAAO,CAAC,KAAK,CAAC,eAAe,EAAE;QAC7B,UAAU;QACV,OAAO;QACP,IAAI,EAAE,GAAG,CAAC,GAAG;QACb,MAAM,EAAE,GAAG,CAAC,MAAM;AAClB,QAAA,KAAK,EAAE;YACL,IAAI,EAAE,KAAK,CAAC,IAAI;YAChB,IAAI,EAAE,KAAK,CAAC,IAAI;YAChB,KAAK,EAAE,KAAK,CAAC,KAAK;YAClB,OAAO,EAAE,KAAK,CAAC,OAAO;AACvB,SAAA;AACF,KAAA,CAAC,CAAC;IAEH,MAAM,SAAS,GAAG,iBAAiB,CAAC,UAAU,EAAE,OAAO,EAAE,KAAK,CAAC,CAAC;AAEhE,IAAA,GAAG,CAAC,SAAS,CAAC,UAAU,EAAE;AACxB,QAAA,cAAc,EAAE,WAAW;AAC3B,QAAA,eAAe,EAAE,UAAU;AAC3B,QAAA,wBAAwB,EAAE,SAAS;AACpC,KAAA,CAAC,CAAC;AACH,IAAA,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AACrB;;;;;"}