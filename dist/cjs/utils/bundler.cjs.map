{"version":3,"file":"bundler.cjs","sources":["../../../src/utils/bundler.ts"],"sourcesContent":["import * as fs from 'fs/promises';\r\nimport * as path from 'path';\r\n\r\nexport async function resolveDependencies(\r\n  filePath: string,\r\n  deps: Set<string> = new Set()\r\n): Promise<Set<string>> {\r\n  if (deps.has(filePath)) return deps;\r\n\r\n  deps.add(filePath);\r\n  const content = await fs.readFile(filePath, 'utf-8');\r\n\r\n  const importMatches = content.match(/(?:require|import)\\s*\\(['\"]([^'\"]+)['\"]\\)/g);\r\n  if (importMatches) {\r\n    for (const match of importMatches) {\r\n      const depPath = match.match(/['\"]([^'\"]+)['\"]/)?.[1];\r\n      if (depPath) {\r\n        const fullPath = path.resolve(path.dirname(filePath), depPath);\r\n\r\n        if (fullPath.endsWith('.js') || fullPath.endsWith('.ts')) {\r\n          await resolveDependencies(fullPath, deps);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return deps;\r\n}\r\n\r\nexport function minifyBundle(code: string): string {\r\n  return code\r\n    .replace(/\\/\\*[\\s\\S]*?\\*\\/|([^\\\\:]|^)\\/\\/.*$/gm, '') // Remove comments\r\n    .replace(/\\s+/g, ' ') // Reduce multiple spaces to single space\r\n    .replace(/^\\s+|\\s+$/gm, ''); // Trim line starts and ends\r\n}\r\n\r\nexport async function generateBundle(projectPath: string, entryPoint: string): Promise<string> {\r\n  const entryFilePath = path.join(projectPath, entryPoint);\r\n  const dependencies = await resolveDependencies(entryFilePath);\r\n\r\n  let bundle = '';\r\n  for (const dep of dependencies) {\r\n    const content = await fs.readFile(dep, 'utf-8');\r\n    bundle += `\\n// File: ${path.relative(projectPath, dep)}\\n${content}\\n`;\r\n  }\r\n\r\n  return minifyBundle(bundle);\r\n}"],"names":["fs","path"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAGO,eAAe,mBAAmB,CACvC,QAAgB,EAChB,IAAA,GAAoB,IAAI,GAAG,EAAE,EAAA;AAE7B,IAAA,IAAI,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC;AAAE,QAAA,OAAO,IAAI,CAAC;AAEpC,IAAA,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IACnB,MAAM,OAAO,GAAG,MAAMA,aAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;IAErD,MAAM,aAAa,GAAG,OAAO,CAAC,KAAK,CAAC,4CAA4C,CAAC,CAAC;AAClF,IAAA,IAAI,aAAa,EAAE;AACjB,QAAA,KAAK,MAAM,KAAK,IAAI,aAAa,EAAE;AACjC,YAAA,MAAM,OAAO,GAAG,KAAK,CAAC,KAAK,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,CAAC;AACrD,YAAA,IAAI,OAAO,EAAE;AACX,gBAAA,MAAM,QAAQ,GAAGC,eAAI,CAAC,OAAO,CAACA,eAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,OAAO,CAAC,CAAC;AAE/D,gBAAA,IAAI,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,QAAQ,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;AACxD,oBAAA,MAAM,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;AAC3C,iBAAA;AACF,aAAA;AACF,SAAA;AACF,KAAA;AAED,IAAA,OAAO,IAAI,CAAC;AACd,CAAC;AAEK,SAAU,YAAY,CAAC,IAAY,EAAA;AACvC,IAAA,OAAO,IAAI;AACR,SAAA,OAAO,CAAC,sCAAsC,EAAE,EAAE,CAAC;AACnD,SAAA,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC;AACpB,SAAA,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC,CAAC;AAChC,CAAC;AAEM,eAAe,cAAc,CAAC,WAAmB,EAAE,UAAkB,EAAA;IAC1E,MAAM,aAAa,GAAGA,eAAI,CAAC,IAAI,CAAC,WAAW,EAAE,UAAU,CAAC,CAAC;AACzD,IAAA,MAAM,YAAY,GAAG,MAAM,mBAAmB,CAAC,aAAa,CAAC,CAAC;IAE9D,IAAI,MAAM,GAAG,EAAE,CAAC;AAChB,IAAA,KAAK,MAAM,GAAG,IAAI,YAAY,EAAE;QAC9B,MAAM,OAAO,GAAG,MAAMD,aAAE,CAAC,QAAQ,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;AAChD,QAAA,MAAM,IAAI,CAAA,WAAA,EAAcC,eAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,GAAG,CAAC,CAAK,EAAA,EAAA,OAAO,IAAI,CAAC;AACzE,KAAA;AAED,IAAA,OAAO,YAAY,CAAC,MAAM,CAAC,CAAC;AAC9B;;;;;;"}